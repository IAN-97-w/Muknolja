<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="chatmapper">
	<insert id="createRoom">
		insert all
		into CHAT_ROOM
		values(#{chatRoom.roomCode}, #{chatRoom.roomName})
		<foreach collection="participants" item="participant">
		into CHAT_USER
		values(#{chatRoom.roomCode}, #{participant})
		</foreach>
		select * from dual
	</insert>
	
	<select id="selectChatRoomList" resultMap="ChatRoomResultSet">
		select *
		from CHAT_ROOM
			join CHAT_USER using(CHAT_ROOM_CODE)
		where PARTICIPANT_ID = #{id}
		
	</select>
	
	<resultMap type="ChatRoom" id="ChatRoomResultSet">
		<id column="CHAT_ROOM_CODE" property="roomCode"/>
		<result column="BOARD_ID" property="BoardId"/>
		<result column="CHAT_ROOM_NAME" property="roomName"/>
	</resultMap>
	
	<select id="selectChatMessage" resultMap="ChatMessageResultSet">
		select *
		from CHAT_MESSAGE
			join member on(SENDER_ID = ID)
		where CHAT_ROOM_CODE = #{roomCode}
		order by CHAT_ID
	</select>
	
	<resultMap type="ChatMessage" id="ChatMessageResultSet">
		<id column="CHAT_ID" property="chatId"/>
		<result column="SENDER_ID" property="senderId"/>
		<result column="CHAT_ROOM_CODE" property="roomCode"/>
		<result column="CHAT_CONTENTS" property="chatContent"/>
		<result column="TRANSFER_TIME" property="transferTime"/>
		<result column="NICKNAME" property="nickName"/>
	</resultMap>
	
	<insert id="insertMessage">
		insert into CHAT_MESSAGE
		values(SEQ_CHATID.nextval, #{senderId}, #{roomCode}, #{chatContent}, sysdate)
	</insert>
	
	<resultMap type="Member" id="memberResultSet">
  		<id column="ID" property="id"/>
  		<result column="PWD" property="pwd"/>
  		<result column="NAME" property="name"/>
  		<result column="NICKNAME" property="nickName"/>
  		<result column="EMAIL" property="email"/>
  		<result column="ADDRESS" property="address"/>
  		<result column="GENDER" property="gender"/>
  		<result column="ENROLL_DATE" property="enrollDate"/>
  		<result column="MEMBER_TYPE" property="memberType"/>
  		<result column="STATUS" property="status"/>
  	</resultMap>
  	
  	<select id="selectUser" resultMap="memberResultSet">
  		select *
  		from member
  		where NICKNAME = #{ncik}
  	</select>
	
	
</mapper>